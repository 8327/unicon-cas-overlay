<?xml version="1.0" encoding="UTF-8"?>
<!--
	| deployerConfigContext.xml centralizes into one file some of the declarative configuration that
	| all CAS deployers will need to modify.
	|
	| This file declares some of the Spring-managed JavaBeans that make up a CAS deployment.  
	| The beans declared in this file are instantiated at context initialization time by the Spring 
	| ContextLoaderListener declared in web.xml.  It finds this file because this
	| file is among those declared in the context parameter "contextConfigLocation".
	|
	| By far the most common change you will need to make in this file is to change the last bean
	| declaration to replace the default SimpleTestUsernamePasswordAuthenticationHandler with
	| one implementing your approach for authenticating usernames and passwords.
	+-->
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:c="http://www.springframework.org/schema/c"
       xmlns:sec="http://www.springframework.org/schema/security"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/security
                           http://www.springframework.org/schema/security/spring-security.xsd">

    <bean id="authenticationManager"
          class="org.jasig.cas.authentication.AuthenticationManagerImpl">

        <property name="credentialsToPrincipalResolvers">
            <list>
                <bean
                        class="org.jasig.cas.authentication.principal.UsernamePasswordCredentialsToPrincipalResolver"
                        p:attributeRepository-ref="attributeRepository"/>

                <bean class="org.jasig.cas.authentication.principal.HttpBasedServiceCredentialsToPrincipalResolver"/>
            </list>
        </property>

        <property name="authenticationHandlers">
            <list>

                <bean class="org.jasig.cas.authentication.handler.support.HttpBasedServiceCredentialsAuthenticationHandler"
                      p:httpClient-ref="httpClient" />

                <bean class="org.jasig.cas.authentication.handler.support.SimpleTestUsernamePasswordAuthenticationHandler"/>

                <!-- Authenticate against Stormpath cloud API -->
                <!-- <bean class="net.unicon.cas.addons.authentication.handler.StormpathAuthenticationHandler"
                      c:stormpathAccessId="${stormpath.apiKey.id}"
                      c:stormpathSecretKey="${stormpath.apiKey.secret}"
                      c:applicationId="${stormpath.application.id}"/> -->
            </list>
        </property>
    </bean>

    <sec:user-service id="userDetailsService">
        <sec:user name="@@THIS SHOULD BE REPLACED@@" password="notused" authorities="ROLE_ADMIN"/>
    </sec:user-service>

    <bean id="attributeRepository" class="net.unicon.cas.addons.persondir.JsonBackedComplexStubPersonAttributeDao" init-method="init">
        <constructor-arg index="0" value="${person.attributes.config.location}"/>
    </bean>

    <!-- This repository sources its attributes from an instance of a Grouper back-end repository -->
    <!-- <bean id="attributeRepository" class="net.unicon.cas.addons.persondir.GrouperPersonAttributeDao"/> -->

    <bean id="serviceRegistryDao" class="net.unicon.cas.addons.serviceregistry.JsonServiceRegistryDao" init-method="loadServices" lazy-init="true">
        <constructor-arg index="0" value="${services.registry.config.location}"/>
    </bean>

    <bean id="auditTrailManager" class="com.github.inspektr.audit.support.Slf4jLoggingAuditTrailManager"/>

    <bean id="healthCheckMonitor" class="org.jasig.cas.monitor.HealthCheckMonitor">
        <property name="monitors">
            <list>
                <bean class="org.jasig.cas.monitor.MemoryMonitor"
                      p:freeMemoryWarnThreshold="10"/>
            </list>
        </property>
    </bean>

</beans>
